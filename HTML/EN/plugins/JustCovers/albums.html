[%- IF !ajaxUpdate %]
[%- pagetitle = 'PLUGIN_JUSTCOVERS' | string -%]

[%- extJsScripts = BLOCK -%]
<link type="text/css" rel=stylesheet href="[% webroot %]plugins/JustCovers/html/css/justcovers.css" />
                                                  
<script type="text/javascript">
    [% PROCESS jsString id='SORT_BY' jsId='sort_by' %]
    [% PROCESS jsString id='ALBUM_DISPLAY_OPTIONS' jsId='display_options' %]

    var orderByList = {};
    [% FOREACH key = orderByList.keys.sort %]
    orderByList["[% key | string %]"] = '[% orderByList.$key | replace("'", "%27") %]';
    [%- END %]

    Ext.onReady(function() {
        var menu = new Ext.menu.Menu();
        menu.add('<span class="menu-title">' + SqueezeJS.string('sort_by') + '...</span>');

		var selectedValue = SqueezeJS.getCookie('Squeezebox-orderBy');
        var selectedLabel;
        for (order in orderByList) {
            var isSelected = (orderByList[order] == selectedValue);
            if (isSelected) {
                selectedLabel = order;
            }

            menu.add(new Ext.menu.CheckItem({
                text: order,
                handler: function(ev) {
                    this.chooseAlbumOrderBy(orderByList[ev.text]);
                },
                scope: this,
                checked: isSelected,
                group: 'sortOrder'}));
        }

        new SqueezeJS.UI.SplitButton({
            renderTo: 'viewSelect',
            cls: 'x-btn-text',
            text: selectedLabel,
            menu: menu,
            arrowTooltip: SqueezeJS.string('display_options')
        });
    });

    function chooseAlbumOrderBy(option) {

        var params = location.search;
        params = params.replace(/&orderBy=[\w\.,]*/ig, '');

        if (option)
            params += '&orderBy=' + option;

        SqueezeJS.setCookie('Squeezebox-orderBy', option);
        location.search = params;
    }

 </script>

[%- END %]

[% IF hasPagebar -%]
[% pageHeaderInfo = BLOCK -%]
    [% PROCESS pagebar -%]
[% END -%]
[% END -%]
        
[% PROCESS pageheader.html %]
[% END %]

[%# detected user-agents in 'browserType' -> 'Firefox' 'Opera' 'Safari' 'IE7' 'IE' %]

[%- FOREACH album = albums %]
<div class="jcCell" style="width:[% size %]px;height:[% size %]px">
    <div class="thumbWrap">
        <div class="thumbArtwork">
        <a href="javascript:void()" onclick="javascript:SqueezeJS.Controller.urlRequest('/anyurl?p0=playlistcontrol&p1=cmd:load&p2=album_id:[% album.id %]&player=[% playerURI %]', 1, SqueezeJS.string('connecting_for'));this.blur(); return true;">

        <img [% IF browserType == 'Firefox' && showShadows %]class="shadow" [% END -%]
         src="[% webroot %]music/[% album.coverid %]/cover_[% size %]x[% size %]_o.jpg"
         width="[% size %]px" height="[% size %]px"
         alt="&quot;[% album.title %]&quot;[%- IF album.year %] ([% album.year %])[% END %] by [% album.artist %]"
         title="&quot;[% album.title %]&quot;[%- IF album.year %] ([% album.year %])[% END %] by [% album.artist %]"/>
        <a/>
        </div>
        
        [% IF showTitle || showArtist || showYear || album.coverid == 0 %]
        <div class="artworkText" style="width:[% size %]px;">
        <span width="[% size %]px">
            [% IF showTitle || album.coverid == 0 %][% album.title %] [% END %]
            [% IF showYear && album.year %]([% album.year %])[% END %]
            [% IF showArtist %][% IF showTitle || showYear %]<br/>[% END %][% album.artist %][% END %]
        </span>
        </div>
        [% END %]
        </a>
    </div>
</div>
[%- END %]

[% titleRight = BLOCK %]
    <div id="viewSelect"></div>
[%- END -%]

[%- infoTab = BLOCK -%]
<div>[% "ALBUMS" | string %] [% pageinfo.startitem + 1 %] [% "TO" | string %] [% pageinfo.enditem + 1 %] [% "OF" | string %] [% pageinfo.totalitems %]</div>
[%- END -%]

[%- IF !ajaxUpdate %]
[% PROCESS pagefooter.html %]
[% END %]

